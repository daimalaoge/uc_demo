{"version":3,"sources":["route.js"],"names":["layui","define","exports","utils","localStorage","setItem","getItem","$","_","undefined","_viewBoxGlobal","this","config","Route","routerViewId","name","beforeRender","prototype","set","options","setRoutes","that","routes","defaults","forEach","item","extend","getTime","random","window","off","on","onChanged","getRoutes","hash","getRoute","route","router","location","r","split","render","renderTarget","callback","_viewBox","NProgress","length","start","_view","viewId","randomCode","parent","remove","cb","done","isFunction","component","data","setUrlState","path","params","href","p","kv","key","value","html","substr","indexOf","index"],"mappings":"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","file":"route.js","sourcesContent":["layui.define(['utils', 'jquery', 'lodash', 'nprogress'], function(exports) {\r\n  var utils = layui.utils,\r\n    localStorage = utils.localStorage,\r\n    setItem = localStorage.setItem,\r\n    getItem = localStorage.getItem,\r\n    $ = layui.jquery,\r\n    _ = layui.lodash;\r\n\r\n  var _viewBoxGlobal = undefined;\r\n\r\n  var Route = function() {\r\n      this.config = {\r\n        name: 'KITADMINROUTE', // 这个不能改，可能会出问题。\r\n        routerViewId: undefined,\r\n        beforeRender: undefined\r\n      };\r\n      this.version = '1.0.0';\r\n    }\r\n    // 设置参数\r\n  Route.prototype.set = function(options) {\r\n    var that = this;\r\n    $.extend(true, that.config, options);\r\n    return that;\r\n  };\r\n  Route.prototype.setRoutes = function(options) {\r\n    var that = this;\r\n    options.name = options.name || that.config.name;\r\n    that.config.name = options.name;\r\n    var defaults = {\r\n      routes: []\r\n    };\r\n    $.extend(true, defaults, options);\r\n    _.forEach(defaults.routes, function(item) {\r\n      item.id = new Date().getTime() + '' + _.random(1000, 9999);\r\n    });\r\n    // 缓存到本地\r\n    setItem(defaults.name, defaults.routes);\r\n    $(window).off('popstate').on('popstate', function() {\r\n      // 是否由外部处理\r\n      if (utils.isFunction(options.onChanged)) {\r\n        options.onChanged();\r\n      } else {\r\n        that.render();\r\n      }\r\n    });\r\n    return that;\r\n  };\r\n  Route.prototype.getRoutes = function() {\r\n    return getItem(this.config.name);\r\n  }\r\n  Route.prototype.getRoute = function(hash) {\r\n    var that = this;\r\n    var routes = that.getRoutes(that.config.name);\r\n    if (routes === null || routes === undefined) {\r\n      return undefined;\r\n    }\r\n    hash = hash || location.hash;\r\n    var route = layui.router(hash);\r\n    return utils.find(routes, function(r) {\r\n      return r.path === route.href.split('?')[0];\r\n    });\r\n  }\r\n  Route.prototype.render = function(hash, renderTarget, callback) {\r\n    var that = this,\r\n      config = that.config,\r\n      _viewBox = undefined;\r\n    // 开始\r\n    NProgress.start();\r\n    if (renderTarget && renderTarget.length > 0) {\r\n      _viewBox = renderTarget;\r\n    } else {\r\n      var _view = config.routerViewId === undefined ?\r\n        $('router-view') : $('router-view#' + config.routerViewId + '');\r\n      // 如果 router-view 标签存在都创建渲染dom,覆盖原来的\r\n      if (_view.length > 0) {\r\n        // 获取id\r\n        var viewId = utils.randomCode();\r\n        _view.parent().append('<div id=\"' + viewId + '\"></div>');\r\n        _view.remove();\r\n        _viewBox = $('#' + viewId);\r\n        _viewBoxGlobal = _viewBox; //缓存一个全局容器 避免单页面的时候 _viewBox 为 undefined\r\n      }\r\n    }\r\n    // 如果是单页面则读取全局\r\n    if (_viewBox === undefined) {\r\n      _viewBox = _viewBoxGlobal;\r\n    }\r\n    var route = that.getRoute(hash);\r\n    var h = [\r\n      '<div class=\"layui-fluid\">',\r\n      '  <div class=\"layui-row\">',\r\n      '    <div class=\"layui-col-xs12\">',\r\n      '      <div class=\"layui-row\">',\r\n      '        <div class=\"layui-col-md4\">&nbsp;</div>',\r\n      '        <div class=\"layui-col-md4\">',\r\n      '          <div class=\"kit-exception\">',\r\n      '            <i class=\"layui-icon kit-exception-icon\">&#xe61c;</i>',\r\n      '            <h3 class=\"kit-exception-title\">:>404 抱歉，你访问的页面不存在</h3>',\r\n      '            <a href=\"javascript:history.back(-1);\" class=\"layui-btn\">返回上一页</a>',\r\n      '          </div>',\r\n      '        </div>',\r\n      '        <div class=\"layui-col-md4\">&nbsp;</div>',\r\n      '      </div>',\r\n      '    </div>',\r\n      '  </div>',\r\n      '</div>'\r\n    ];\r\n    if (route !== undefined) {\r\n      if (typeof config.beforeRender === 'function') {\r\n        route = config.beforeRender(route);\r\n      }\r\n      utils.tplLoader(route.component, function(data) {\r\n        _viewBox.html(data);\r\n        cb();\r\n        // 设置浏览器地址显示\r\n        utils.setUrlState(route.name, '#' + route.path);\r\n      }, function(errorMsg) {\r\n        let h = [\r\n          '<div class=\"layui-fluid\">',\r\n          '<div class=\"layui-row\">',\r\n          '<div class=\"layui-col-xs12\">',\r\n          '<div class=\"kit-not-router\">',\r\n          errorMsg,\r\n          '</div>',\r\n          '</div>',\r\n          '</div>',\r\n          '</div>'\r\n        ].join('');\r\n        _viewBox.html(h);\r\n        cb();\r\n      });\r\n    } else {\r\n      _viewBox.html(h.join(''));\r\n      NProgress.done();\r\n    }\r\n\r\n    function cb() {\r\n      // 结束\r\n      NProgress.done();\r\n      utils.isFunction(callback) && callback();\r\n    }\r\n    return that;\r\n  };\r\n  Route.prototype.params = function() {\r\n    var router = layui.router();\r\n    if (router.href === undefined) return null;\r\n    var href = router.href;\r\n    var p = href.substr(href.indexOf('?') + 1);\r\n    if (href === p) return null;\r\n    var params = p.split('&');\r\n    var data = {};\r\n    _.forEach(params, function(item, index) {\r\n      var kv = item.split('=');\r\n      var key = kv[0];\r\n      var value = kv[1];\r\n      data[key] = value;\r\n    });\r\n    return data;\r\n  }\r\n  var route = new Route();\r\n  //输出router接口\r\n  exports('route', route);\r\n});"]}