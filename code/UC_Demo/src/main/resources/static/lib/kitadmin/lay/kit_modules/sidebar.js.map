{"version":3,"sources":["sidebar.js"],"names":["layui","define","exports","$","jquery","laytpl","layer","_","lodash","utils","this","Sidebar","elem","content","shade","shadeClose","title","direction","dynamicRender","url","width","done","join","defaults","that","id","config","undefined","options","tplLoader","_private","renderHTML","data","extend","errMsg","oneOf","error","_elem","render","Date","getTime","html","_body","_shade","_sidebar","tpl","show","append","click","attr","on","animate","_defineProperty","find","_that","parent","_typeof","showLoading","hideLoading","setTimeout","next","addClass","_load","remove","sidebar","load_tpl"],"mappings":"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","file":"sidebar.js","sourcesContent":["layui.define(['layer', 'laytpl', 'utils', 'lodash'], function (exports) {\r\n  const $ = layui.jquery,\r\n    layer = layui.layer,\r\n    laytpl = layui.laytpl,\r\n    _ = layui.lodash,\r\n    utils = layui.utils,\r\n    _body = $('body');\r\n  const Sidebar = function () {\r\n    this.version = '1.0.0';\r\n  };\r\n  const tpl = [\r\n    '<div class=\"kit-sidebar\" style=\"{{d.direction}}:-{{d.width}};width:{{d.width}};\" kit-sidebar=\"{{d.id}}\">',\r\n    '<div class=\"kit-sidebar-body\">',\r\n    '  <div class=\"layui-card\">',\r\n    '    <div class=\"layui-card-header\">',\r\n    '      <span class=\"nowrap\" title=\"{{d.title}}\">{{d.title}}</span>',\r\n    '      <div class=\"kit-sidebar-reload\" title=\"刷新\">',\r\n    '        <i class=\"layui-icon\">&#x1002;</i>',\r\n    '      </div>',\r\n    '      <div class=\"kit-sidebar-close\" title=\"关闭\">',\r\n    '        <i class=\"layui-icon\">&#x1006;</i>',\r\n    '      </div>',\r\n    '    </div>',\r\n    '    <div class=\"layui-card-body\">',\r\n    '      {{d.content}}',\r\n    '    </div>',\r\n    '  </div>',\r\n    '</div>',\r\n    '</div>'\r\n  ].join('');\r\n  const load_tpl = [\r\n    '<div class=\"kit-sidebar-loading layui-anim layui-anim-fadein\">',\r\n    '    <div>',\r\n    '        <i class=\"layui-icon layui-anim layui-anim-rotate layui-anim-loop\">&#xe63e;</i>',\r\n    '    </div>',\r\n    '</div>',\r\n  ]\r\n  Sidebar.prototype.defaults = {\r\n    elem: undefined, // 触发按钮\r\n    content: '', // 内容\r\n    shade: false, //显示遮盖层\r\n    shadeClose: true, // 点击遮盖层关闭\r\n    title: '未命名', //标题\r\n    direction: 'right', //方向  支持left or right \r\n    dynamicRender: false, //是否动态渲染\r\n    url: undefined, //远程地址\r\n    width: '280px', //盒子的宽度\r\n    done: undefined\r\n  };\r\n  Sidebar.prototype.render = function (options) {\r\n    const that = this;\r\n    // 克隆默认配置 -- 为了默认配置的干净\r\n    let defaults = _.cloneDeep(that.defaults);\r\n    $.extend(true, defaults, options);\r\n    const config = defaults;\r\n    // validate\r\n    if (!utils.oneOf(config.direction, ['left', 'right'])) {\r\n      utils.error('Sidebar error: [direction] property error,Only \"left\" or \"right\" .');\r\n      return that;\r\n    }\r\n    const data = {\r\n      title: config.title,\r\n      id: utils.randomCode(),\r\n      content: config.content,\r\n      direction: config.direction,\r\n      width: config.width\r\n    };\r\n    if (config.dynamicRender) {\r\n      const url = config.url + '?version=' + new Date().getTime();\r\n      utils.tplLoader(url, function (content) {\r\n        data.content = content;\r\n        _private.renderHTML(config, data);\r\n      }, function (errMsg) {\r\n        data.content = errMsg;\r\n        _private.renderHTML(config, data);\r\n      })\r\n    } else {\r\n      _private.renderHTML(config, data);\r\n    }\r\n    return that;\r\n  };\r\n  const _private = {\r\n    renderHTML: function (config, data) {\r\n      const _elem = $(config.elem);\r\n      if (_elem.attr('kit-sidebar-target') !== undefined) {\r\n        return;\r\n      }\r\n      laytpl(tpl).render(data, function (html) {\r\n        // 添加遮盖层\r\n        if (config.shade) {\r\n          html = html + '<div class=\"kit-shade\" kit-shade=\"' + data.id + '\"></div>';\r\n        }\r\n        _body.append(html);\r\n        typeof config.done === 'function' && config.done();\r\n        // 处理事件\r\n        const _sidebar = $('div[kit-sidebar=\"' + data.id + '\"]');\r\n        const _shade = $('div[kit-shade=\"' + data.id + '\"]');\r\n        _elem.attr('data-toggle', 'off');\r\n        _elem.attr('kit-sidebar-target', 'true');\r\n        _elem.on('click', function () {\r\n          const toggle = $(this).data('toggle');\r\n          switch (toggle) {\r\n            case 'on':\r\n              _sidebar.animate({\r\n                [config.direction]: '-' + config.width\r\n              });\r\n              _shade.hide();\r\n              $(this).data('toggle', 'off');\r\n              break;\r\n            case 'off':\r\n              _sidebar.animate({\r\n                [config.direction]: '0px'\r\n              });\r\n              _shade.show();\r\n              $(this).data('toggle', 'on');\r\n              break;\r\n          }\r\n        });\r\n        // 如果是elem为object 则直接触发事件\r\n        if (typeof config.elem === 'object') {\r\n          _elem.click();\r\n        }\r\n        // 遮盖层点击关闭\r\n        config.shadeClose && _shade.on('click', function () {\r\n          _elem.click();\r\n        });\r\n        // 绑定刷新事件\r\n        _sidebar.find('.kit-sidebar-reload').on('click', function () {\r\n          const _that = this;\r\n          if (config.dynamicRender) {\r\n            // 显示加载层\r\n            _private.showLoading(_sidebar);\r\n            const url = config.url + '?version=' + new Date().getTime();\r\n            utils.tplLoader(url, function (data) {\r\n              $(_that).parent().next('.layui-card-body').html(data);\r\n              // 关闭加载层\r\n              _private.hideLoading(_sidebar);\r\n            }, function (errMsg) {\r\n              $(_that).parent().next('.layui-card-body').html('Loading error:' + errMsg);\r\n              // 关闭加载层\r\n              _private.hideLoading(_sidebar);\r\n            })\r\n          }\r\n        });\r\n        // 绑定关闭事件\r\n        _sidebar.find('.kit-sidebar-close').on('click', function () {\r\n          _elem.click();\r\n        });\r\n      });\r\n    },\r\n    // 显示加载层\r\n    showLoading: function (_sidebar) { //fadein\r\n      _sidebar.append(load_tpl.join(''));\r\n    },\r\n    // 移除加载层\r\n    hideLoading: function (_sidebar) {\r\n      setTimeout(function () {\r\n        const _load = _sidebar.find('.kit-sidebar-loading');\r\n        _load.addClass('layui-anim-fadeout');\r\n        setTimeout(function () {\r\n          _load.remove();\r\n        }, 300);\r\n      }, 500);\r\n    }\r\n  };\r\n  const sidebar = new Sidebar();\r\n  //输出sidebar接口\r\n  exports('sidebar', sidebar);\r\n});"]}