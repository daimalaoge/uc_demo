{"version":3,"sources":["tabs.js"],"names":["layui","define","exports","layer","jquery","laytpl","utils","_","storage","route","lodash","KITADMINTABS","TABS","TAB_TITLE","TOOLSBOX","TAB_CLOSE","tabsContent","undefined","tabsTitle","toolsBox","templates","TITLE","CONTENT","TOOLSITEM","Tabs","onChangeBefore","onChanged","onRendered","join","isInit","prototype","that","extend","children","$","_that","_content","isRendered","options","_private","config","close","find","attr","stope","remove","target","each","index","element","parent","on","layid","getContent","renderHTMLForContent","elem","path","nextHandler","toolBoxHandler","length","e","initCaches","off","this","parents","prevHandler","items","item","isFunction","callback","tabCount","exists","switch","getCurrId","getByPath","active","getCaches","d","id","t","append","thtml","push","render","html","title","component","chtml","rendered","icon","_title","findTitle","hasClass","prevLayid","rIndex","prev","liWidth","width","offsetLeft","ol","tabWidth","p","splice","arguments","handle","forEach","currActive","setCaches","addClass","findTitleByPath","siblings","removeClass","existsByPath","text","_container","tabsLeft","init","left","style","parseInt","substr","indexOf","liCountWidth","tabsWidth","colCount","PREV","toolHandler","hide","NEXT","document","i","tabs","action","data","currId","add","findTools","findContent","setItem","getItem"],"mappings":"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","file":"tabs.js","sourcesContent":["layui.define(['layer', 'laytpl', 'utils', 'lodash', 'route'], function(exports) {\r\n  var layer = layui.layer,\r\n    $ = layui.jquery,\r\n    laytpl = layui.laytpl,\r\n    utils = layui.utils,\r\n    _ = layui.lodash,\r\n    storage = utils.localStorage,\r\n    route = layui.route;\r\n\r\n\r\n  const KITADMINTABS = 'KITADMINTABS';\r\n\r\n  var TABS = '.kit-tabs',\r\n    PREV = '.kit-tabs-prev',\r\n    NEXT = '.kit-tabs-next',\r\n    TOOLS = '.kit-tabs-tools',\r\n    TAB_TITLE = '.kit-tab-title',\r\n    TAB_CLOSE = '.kit-tab-close',\r\n    TOOLSBOX = '.kit-tabs-toolsbox';\r\n\r\n  var tabsContent = undefined,\r\n    tabsTitle = undefined,\r\n    toolsBox = undefined,\r\n    templates = {\r\n      TITLE: ['<li lay-id=\"{{d.id}}\" data-path={{d.path}}>',\r\n        '<span title=\"{{d.title}}\">',\r\n        '{{#if(d.icon){}}',\r\n        '<i class=\"layui-icon\">{{d.icon}}</i> ',\r\n        '{{#}}}',\r\n        '{{d.title}}',\r\n        '</span>',\r\n        '<i class=\"layui-icon kit-tab-close\">&#x1006;</i>',\r\n        '</li>'\r\n      ].join(''),\r\n      CONTENT: ['<div class=\"kit-tabs-item\" data-path={{d.path}} lay-tab-id=\"{{d.id}}\" data-component=\"{{d.component}}\" data-rendered=\"{{d.rendered}}\">',\r\n        '<router-view></router-view>',\r\n        '</div>'\r\n      ].join(''),\r\n      TOOLSITEM: [\r\n        '<li class=\"kit-item\" lay-id=\"{{d.id}}\">',\r\n        '<a href=\"javascript:;\">',\r\n        '<span title=\"{{d.title}}\">{{d.title}}</span>&nbsp;',\r\n        '<i class=\"layui-icon layui-close\">&#x1006;</i>',\r\n        '</a>',\r\n        '</li>'\r\n      ].join('')\r\n    };\r\n\r\n  var Tabs = function() {\r\n    this.config = {\r\n      onChangeBefore: undefined,\r\n      onChanged: undefined,\r\n      onRendered: undefined\r\n    };\r\n    this.version = '1.0.0';\r\n  }\r\n  var isInit = false;\r\n  Tabs.prototype.set = function(options) {\r\n    var that = this;\r\n    $.extend(true, that.config, options);\r\n    return that;\r\n  };\r\n  Tabs.prototype.render = function(callback) {\r\n    var that = this;\r\n    var target = $(TABS).attr('kit-target');\r\n    tabsTitle = tabsTitle === undefined ? $(TAB_TITLE) : tabsTitle;\r\n    tabsContent = tabsContent === undefined ? $('div.kit-tabs-content[kit-tabs=\"' + target + '\"]') : tabsContent;\r\n    toolsBox = toolsBox === undefined ? $(TOOLSBOX).children('ul') : toolsBox;\r\n\r\n    tabsTitle.children('li').each(function(index, element) {\r\n      var _that = $(this);\r\n      var layid = _that.attr('lay-id');\r\n      _that.off('click').on('click', function() {\r\n        var _content = _private.getContent(layid);\r\n        // 如果该选项卡未渲染则需要执行渲染操作\r\n        if (_content.isRendered === 'false') {\r\n          _private.renderHTMLForContent(_content.elem, _content.path);\r\n        }\r\n        that.switch(layid);\r\n      });\r\n      var close = _that.find(TAB_CLOSE);\r\n      if (close.length === 1) {\r\n        close.off('click').on('click', function(e) {\r\n          layui.stope(e);\r\n          that.remove(layid);\r\n        });\r\n      }\r\n      // 绑定工具栏的移除事件\r\n      $(TOOLSBOX).find('.layui-close').off('click').on('click', function(e) {\r\n        layui.stope(e);\r\n        var parent = $(this).parents('.kit-item')\r\n        var layid = parent.attr('lay-id');\r\n        that.remove(layid);\r\n      });\r\n    });\r\n    _private.prevHandler();\r\n    _private.nextHandler();\r\n    _private.toolHandler();\r\n    _private.toolBoxHandler(that);\r\n    if (!isInit) {\r\n      isInit = true;\r\n      _private.initCaches(that);\r\n    }\r\n    utils.isFunction(callback) && callback({\r\n      tabCount: $(TAB_TITLE).children('li').length,\r\n      isIndex:_private.findTitle(_private.getCurrId()).attr('data-path') === '#/'\r\n    });\r\n    return that;\r\n  };\r\n  Tabs.prototype.add = function(options, callback) {\r\n    var that = this,\r\n      config = that.config;\r\n    if (options.active === undefined) {\r\n      // 读取缓存的tabs\r\n      var items = _private.getCaches();\r\n      var item = utils.find(items, function(d) {\r\n        return d.path === options.path;\r\n      });\r\n      // 如果在缓存中找到对应的tab信息则覆盖id\r\n      if (item !== undefined) {\r\n        options.id = item.id;\r\n      }\r\n      if (that.exists(options.id)) {\r\n        that.switch(options.id);\r\n        return;\r\n      } else if (that.existsByPath(options.path)) { //如果通过layid找不到则通过路由地址找\r\n        var t = that.getByPath(options.path);\r\n        that.switch(t.id);\r\n        return;\r\n      }\r\n    } else {\r\n      // 处理读取历史初始化的tabs\r\n      if (that.exists(options.id)) {\r\n        that.switch(options.id, true);\r\n        return;\r\n      } else if (that.existsByPath(options.path)) { //如果通过layid找不到则通过路由地址找\r\n        var t = that.getByPath(options.path);\r\n        that.switch(t.id, true);\r\n        return;\r\n      }\r\n    }\r\n    laytpl(templates.TITLE).render(options, function(html) {\r\n      // 渲染title\r\n      tabsTitle.append(html);\r\n      // 渲染主体内容\r\n      laytpl(templates.CONTENT).render(options, function(chtml) {\r\n        tabsContent.append(chtml);\r\n        //添加至右侧工具栏\r\n        laytpl(templates.TOOLSITEM).render(options, function(thtml) {\r\n          toolsBox.append(thtml);\r\n          // 处理缓存\r\n          var items = _private.getCaches();\r\n          var item = utils.find(items, function(d) {\r\n            return d.path === options.path;\r\n          });\r\n          // 如果不存在，则添加一个\r\n          if (item === undefined) {\r\n            items.push({\r\n              id: options.id,\r\n              title: options.title,\r\n              path: options.path,\r\n              component: options.component,\r\n              rendered: false,\r\n              active: true,\r\n              icon: options.icon\r\n            });\r\n          } else {\r\n            // 更新id\r\n            item.id = options.id;\r\n          }\r\n          _private.setCaches(items); //保存缓存数据\r\n          // 重新渲染\r\n          that.render();\r\n          if (options.active === undefined) {\r\n            that.switch(options.id); //获取焦点\r\n          } else {\r\n            if (options.active) that.switch(options.id, true);\r\n          }\r\n          utils.isFunction(callback) && callback();\r\n        });\r\n      });\r\n      // utils.isFunction(config.onRendered) && config.onRendered();\r\n    });\r\n  };\r\n  Tabs.prototype.remove = function(layid) {\r\n    var that = this;\r\n    var _title = _private.findTitle(layid);\r\n    // 如果是删除当前获取焦点的选项卡才销换到上一个，否则不切换\r\n    if (_title.hasClass('layui-this')) {\r\n      var prevLayid = _title.prev().attr('lay-id');\r\n      // 切换到上一个选项卡\r\n      that.switch(prevLayid);\r\n    }\r\n    // 移除\r\n    _title.remove();\r\n    _private.findContent(layid).remove();\r\n    _private.findTools(layid).remove();\r\n\r\n    var items = _private.getCaches();\r\n    var rIndex = items.findIndex(p => p.id === layid);\r\n    items.splice(rIndex, 1);\r\n    _private.setCaches(items);\r\n  };\r\n  Tabs.prototype.switch = function(layid, isInit = false) {\r\n    var that = this,\r\n      config = that.config;\r\n    var _that = _private.findTitle(layid);\r\n    var liWidth = _that.width() + 50;\r\n    var ol = _that[0].offsetLeft;\r\n    var tabWidth = tabsTitle.parent('div.kit-tab').width()\r\n    if (ol > tabWidth) {\r\n      var c = ol - tabWidth + liWidth;\r\n    }\r\n    var path = _that.attr('data-path');\r\n    var items = _private.getCaches();\r\n    var item = utils.find(items, function(d) {\r\n      return d.path === path;\r\n    });\r\n    // 如果是初始化，只切换到上一次选中的选项卡\r\n    if (item !== undefined && item.active && isInit) {\r\n      handle();\r\n      _that.click(); // 模拟点击当前选中的选项卡\r\n    }\r\n    // 如果是点击切换\r\n    if (!isInit) {\r\n      handle();\r\n      _.forEach(items, function(item) {\r\n        item.active = false;\r\n      });\r\n      var currActive = utils.find(items, function(d) {\r\n        return d.path === path;\r\n      });\r\n      if (currActive !== undefined) {\r\n        currActive.active = true;\r\n      }\r\n      _private.setCaches(items);\r\n      var _content = _private.getContent(layid);\r\n      // 如果该选项卡未渲染则需要执行渲染操作\r\n      if (_content.isRendered === 'false') {\r\n        _private.renderHTMLForContent(_content.elem, _content.path);\r\n      }\r\n    }\r\n\r\n    // 触发选项卡切换事件\r\n    utils.isFunction(config.onChanged) && config.onChanged(layid);\r\n    /** \r\n     * 处理样式切换\r\n     */\r\n    function handle() {\r\n      // 切换对应的title item\r\n      _that.addClass('layui-this')\r\n        .siblings().removeClass('layui-this');\r\n      // 切换对应的content item\r\n      _private.findContent(layid)\r\n        .addClass('layui-show')\r\n        .siblings().removeClass('layui-show');\r\n      // 切换对应的tools item\r\n      _private.findTools(layid)\r\n        .addClass('layui-this')\r\n        .siblings().removeClass('layui-this');\r\n\r\n      var _content = _private.getContent(layid);\r\n      // 设置浏览器地址显示\r\n      utils.setUrlState(_content.path, _content.path);\r\n    }\r\n  }\r\n  Tabs.prototype.switchByPath = function(path){\r\n    var that = this;\r\n    var _title = _private.findTitleByPath(path);\r\n    if(_title.length>0){\r\n      that.switch(_title.attr('lay-id'));\r\n    }\r\n  }\r\n  Tabs.prototype.exists = function(layid) {\r\n    return _private.findTitle(layid).length > 0;\r\n  }\r\n  Tabs.prototype.existsByPath = function(path) {\r\n    return _private.findTitleByPath(path).length > 0;\r\n  }\r\n  Tabs.prototype.get = function(layid) {\r\n    var that = this;\r\n    if (!that.exists(layid))\r\n      return null;\r\n    var _title = _private.findTitle(layid);\r\n    var title = _title.children('span').text();\r\n    var path = _title.attr('data-path');\r\n    return {\r\n      id: layid,\r\n      title: title,\r\n      path: path\r\n    };\r\n  }\r\n  Tabs.prototype.getByPath = function(path) {\r\n    var that = this;\r\n    if (!that.existsByPath(path))\r\n      return null;\r\n    var _title = _private.findTitleByPath(path);\r\n    var title = _title.children('span').text();\r\n    var layid = _title.attr('lay-id');\r\n    return {\r\n      id: layid,\r\n      title: title,\r\n      path: path\r\n    };\r\n  }\r\n  Tabs.prototype.getCurrId = function() {\r\n    return _private.getCurrId();\r\n  };\r\n  Tabs.prototype.init = function() {\r\n    var that = this;\r\n    _private.initCaches(that);\r\n    return that;\r\n  };\r\n\r\n  var _private = {\r\n    renderHTMLForContent(_container, path) {\r\n      route.render(path, _container, function() {\r\n        // 将状态更新为已渲染\r\n        _container.attr('data-rendered', 'true');\r\n      });\r\n    },\r\n    prevHandler: function() {\r\n      // prev event\r\n      $(PREV).off('click').on('click', function() {\r\n        var tabsLeft = tabsTitle[0].style.left;\r\n        var left = parseInt(tabsLeft.substr(0, tabsLeft.indexOf('px')));\r\n\r\n        if (left === 0) {\r\n          return;\r\n        } else {\r\n          left += $(TABS).width();\r\n          left = left > 0 ? 0 : left;\r\n          tabsTitle.animate({\r\n            'left': left + 'px'\r\n          });\r\n        }\r\n      });\r\n    },\r\n    nextHandler: function() {\r\n      // next event\r\n      $(NEXT).off('click').on('click', function() {\r\n        var tabsLeft = tabsTitle[0].style.left;\r\n        var left = parseInt(tabsLeft.substr(0, tabsLeft.indexOf('px')));\r\n\r\n        var tabsWidth = $(TABS).width();\r\n        var liCountWidth = -18;\r\n        tabsTitle.children('li').each(function() {\r\n          var width = $(this).width();\r\n          liCountWidth += (width + 48);\r\n        });\r\n        if (tabsWidth < liCountWidth && (left - tabsWidth) > -liCountWidth) {\r\n          var colCount = parseInt(liCountWidth / tabsWidth);\r\n          left = (left - tabsWidth) >= 0 ? 0 : (left - tabsWidth);\r\n\r\n          tabsTitle.animate({\r\n            'left': left + 'px'\r\n          });\r\n        }\r\n      });\r\n    },\r\n    toolHandler: function() {\r\n      $(TOOLS).off('click').on('click', function(e) {\r\n        layui.stope(e);\r\n        $(TOOLSBOX).show();\r\n        $(document).on('click', function() {\r\n          $(TOOLSBOX).hide();\r\n          $(this).off('click');\r\n        });\r\n      });\r\n    },\r\n    toolBoxHandler: function(tabs) {\r\n      var that = this;\r\n      $(TOOLSBOX).find('li.kit-item').each(function() {\r\n        var _that = $(this);\r\n        var action = _that.data('action');\r\n        var currId = _that.attr('lay-id');\r\n        _that.off('click').on('click', function() {\r\n          var layid = that.getCurrId();\r\n          switch (action) {\r\n            case 'closeOther':\r\n              tabsTitle.find('li:not(\"[lay-id=' + layid + ']\")').each(function(i, e) {\r\n                var id = $(this).attr('lay-id');\r\n                if (i !== 0) {\r\n                  tabs.remove(id);\r\n                }\r\n              });\r\n              break;\r\n            case 'closeAll':\r\n              tabsTitle.find('li:first-child').siblings().each(function() {\r\n                var id = $(this).attr('lay-id');\r\n                tabs.remove(id);\r\n              });\r\n              break;\r\n            default:\r\n              var _content = _private.getContent(currId);\r\n              if (_content.isRendered === 'false') {\r\n                _private.renderHTMLForContent(_content.elem, _content.path);\r\n              }\r\n              tabs.switch(currId);\r\n              break;\r\n          }\r\n          $(TOOLSBOX).hide();\r\n        });\r\n      });\r\n    },\r\n    initCaches: function(_that) {\r\n      var items = this.getCaches();\r\n      _.forEach(items, function(item) {\r\n        _that.add(item);\r\n      });\r\n    },\r\n    findTitle: function(layid) {\r\n      return tabsTitle.children('li[lay-id=\"' + layid + '\"]');\r\n    },\r\n    findTitleByPath: function(path) {\r\n      return tabsTitle.children('li[data-path=\"' + path + '\"]');\r\n    },\r\n    findContent: function(layid) {\r\n      return tabsContent.children('div.kit-tabs-item[lay-tab-id=\"' + layid + '\"]');\r\n    },\r\n    getContent: function(layid) {\r\n      var _content = this.findContent(layid);\r\n      return {\r\n        elem: _content,\r\n        component: _content.attr('data-component'),\r\n        path: _content.attr('data-path'),\r\n        isRendered: _content.attr('data-rendered'),\r\n      };\r\n    },\r\n    findTools: function(layid) {\r\n      return toolsBox.find('li.kit-item[lay-id=\"' + layid + '\"]');\r\n    },\r\n    getCurrId: function() {\r\n      return tabsTitle.find('li.layui-this').attr('lay-id');\r\n    },\r\n    getCaches: function() {\r\n      var items = storage.getItem(KITADMINTABS);\r\n      if (items === null) {\r\n        items = [];\r\n      }\r\n      return items;\r\n    },\r\n    setCaches: function(data) {\r\n      storage.setItem(KITADMINTABS, data)\r\n    }\r\n  }\r\n\r\n  var tabs = new Tabs();\r\n\r\n  //输出tabs接口\r\n  exports('tabs', tabs);\r\n});"]}