{"version":3,"sources":["menu.js"],"names":["layui","define","exports","$","jquery","utils","_","lodash","axios","storage","this","Menu","undefined","dynamicRender","elem","onClicked","data","url","method","isJump","cacheKey","MENU","MENU_ITEM","THIS","set","options","extend","config","prototype","render","that","length","setItem","_private","renderHTML","bind","isHandled","cached","getItem","loadData","remote","each","_menu","hasChild","find","_item","_a","attr","layid","randomCode","e","addClass","hasClass","off","on","removeClass","stope","removeCache","key","removeItem","callback","temps","recursion","_elem","push","error","join","isFunction","temp","datas","pid","curr","item","index","forEach","open","path","blank","href","icon","title","children","res","status","Error","statusText","catch"],"mappings":"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","file":"menu.js","sourcesContent":["layui.define(['jquery', 'utils', 'axios'], function(exports) { //提示：模块也可以依赖其它模块，如：layui.define('layer', callback);\r\n  var $ = layui.jquery,\r\n    utils = layui.utils,\r\n    _ = layui.lodash,\r\n    axios = layui.axios,\r\n    storage = utils.localStorage;\r\n  var Menu = function() {\r\n    this.config = {\r\n      elem: undefined, // 容器\r\n      onClicked: undefined, // 点击后触发的回调\r\n      dynamicRender: false, // 是否动态渲染 --如果此参数为true,则需要设置elem,[data或者remote]参数\r\n      data: [], // 数据\r\n      remote: { //此配置请参数axios的request配置，文档地址：https://www.kancloud.cn/yunye/axios/234845\r\n        url: undefined,\r\n        method: 'get'\r\n      },\r\n      cached: false, // 是否开启缓存,注：只缓存远程加载的数据。\r\n      cacheKey: 'KITADMINMENU', // 缓存key\r\n      isJump: true, //是否直接跳转页面\r\n    };\r\n    this.version = '1.0.0';\r\n  }\r\n  var MENU = '.kit-menu',\r\n    MENU_ITEM = '.kit-menu-item',\r\n    MENU_CHILD = '.kit-menu-child',\r\n    THIS = '.layui-this',\r\n    SHOW = '.layui-show';\r\n  // 设置参数\r\n  Menu.prototype.set = function(options) {\r\n    var that = this;\r\n    $.extend(true, that.config, options);\r\n    return that;\r\n  };\r\n  // 渲染\r\n  Menu.prototype.render = function() {\r\n    var that = this,\r\n      config = that.config;\r\n    // 是否需要动态渲染\r\n    if (config.dynamicRender) {\r\n      //本地数据优先级最高\r\n      if (config.data.length > 0) {\r\n        // 缓存数据\r\n        storage.setItem(config.cacheKey, data);\r\n        // 渲染DOM\r\n        _private.renderHTML(config.elem, config.data, function() {\r\n          // 绑定事件\r\n          that.bind();\r\n        });\r\n      } else {\r\n        //是否已经处理\r\n        var isHandled = false;\r\n        if (config.cached) {\r\n          var data = storage.getItem(config.cacheKey);\r\n          if (data !== null && data !== undefined) {\r\n            isHandled = true;\r\n            _private.renderHTML(config.elem, data, function() {\r\n              that.bind();\r\n            });\r\n          }\r\n        }\r\n        if (!isHandled) {\r\n          // 远程读取\r\n          _private.loadData(config.remote, function(data) {\r\n            // 缓存数据\r\n            storage.setItem(config.cacheKey, data);\r\n            // 渲染DOM\r\n            _private.renderHTML(config.elem, data, function() {\r\n              that.bind();\r\n            });\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      //绑定事件\r\n      that.bind();\r\n    }\r\n    return that;\r\n  };\r\n  // 绑定事件\r\n  Menu.prototype.bind = function() {\r\n    var that = this,\r\n      config = that.config;\r\n    var _menu = config\r\n    $(MENU).find(MENU_ITEM).each(function() {\r\n      var _item = $(this);\r\n      var _a = _item.children('a');\r\n      var hasChild = _item.find('ul.kit-menu-child').length > 0;\r\n      if (hasChild) {\r\n        _a.addClass('child');\r\n      }\r\n      var layid = _item.attr('lay-id');\r\n      if (layid === '' || layid === undefined) {\r\n        layid = utils.randomCode();\r\n        _item.attr('lay-id', layid);\r\n      }\r\n      _a.off('click').on('click', function(e) {\r\n        layui.stope(e);\r\n        if (!hasChild) {\r\n          $(MENU).find(MENU_ITEM).removeClass('layui-this');\r\n          _item.addClass('layui-this');\r\n        } else {\r\n          if (_item.hasClass('layui-show')) {\r\n            _item.removeClass('layui-show');\r\n          } else {\r\n            _item.addClass('layui-show');\r\n          }\r\n        }\r\n        utils.isFunction(config.onClicked) && config.onClicked({\r\n          elem: _item,\r\n          hasChild: hasChild,\r\n          data: {\r\n            href: _a.attr('href'),\r\n            layid: layid\r\n          }\r\n        });\r\n        // 拦截a标签的跳转\r\n        if (!config.isJump) {\r\n          debugger;\r\n          return false;\r\n        }\r\n      });\r\n    });\r\n    return that;\r\n  };\r\n  // 移除缓存\r\n  Menu.prototype.removeCache = function(key) {\r\n    var that = this,\r\n      config = that.config;\r\n    key = key || config.cacheKey;\r\n    utils.localStorage.removeItem(key);\r\n  };\r\n\r\n  // 私有方法\r\n  var _private = {\r\n    // 渲染HTML\r\n    renderHTML: function(elem, data, callback) {\r\n      var that = this;\r\n      var temps = ['<ul class=\"kit-menu\">'];\r\n\r\n      var pid = 0; //一级菜单pid为0 ，这是一个约定\r\n      that.recursion(temps, data, pid);\r\n      if (temps.length > 0) {\r\n        // 闭合ul\r\n        temps.push('</ul>');\r\n        var _elem = $(elem);\r\n        if (_elem.length === 0) {\r\n          utils.error('Menu config error:请配置elem参数.');\r\n          return;\r\n        }\r\n        _elem.html(temps.join(''));\r\n        utils.isFunction(callback) && callback();\r\n      }\r\n    },\r\n    // 递归组装dom\r\n    recursion: function(temp, datas, pid) {\r\n      var that = this;\r\n      var curr = [];\r\n      _.forEach(datas, function(item, index) {\r\n        if (item.pid === pid)\r\n          curr.push(item);\r\n      });\r\n      if (curr.length > 0) {\r\n        _.forEach(curr, function(item) {\r\n          var open = item.open ? 'layui-show' : '';\r\n          temp.push('<li class=\"kit-menu-item ' + open + '\">');\r\n          var href = _.isEmpty(item.path) ? 'javascript:;' : item.path;\r\n          if (item.blank) {\r\n            temp.push('<a href=\"' + href + '\" target=\"_blank\">');\r\n          } else {\r\n            temp.push('<a href=\"' + href + '\">');\r\n          }\r\n          temp.push('<i class=\"layui-icon\">' + item.icon + '</i> ');\r\n          temp.push('<span>' + item.title + '</span>');\r\n          temp.push('</a>');\r\n          var children = item.children;\r\n          if (children !== undefined && children !== null && children.length > 0) {\r\n            temp.push('<ul class=\"kit-menu-child layui-anim layui-anim-upbit\">');\r\n            that.recursion(temp, children, item.id);\r\n            temp.push('</ul>');\r\n          }\r\n          temp.push('</li>');\r\n        });\r\n      }\r\n    },\r\n    // 远程加载数据\r\n    loadData: function(options, callback) {\r\n      axios(options)\r\n        .then(function(res) {\r\n          if (res.status === 500)\r\n            throw new Error(res.statusText);\r\n          return res.data;\r\n        })\r\n        .then(function(data) {\r\n          callback(data);\r\n        })\r\n        .catch(function(error) {\r\n          utils.error(error);\r\n        });\r\n    }\r\n  };\r\n\r\n  var menu = new Menu();\r\n\r\n  //输出menu接口\r\n  exports('menu', menu);\r\n});"]}